/**
 * Rehype plugin.
 *
 * @note PLEASE DO NOT EDIT THIS FILE!
 * @note This entire file will be updated automatically.
 * @note Instead of editing here, please review <https://github.com/clevercanyon/skeleton>.
 */

import { visit as unistVisit } from 'unist-util-visit';

/**
 * Modifies external anchors by adding `rel` attribute for improved SEO.
 */
export default () => {
    return (tree) => {
        unistVisit(tree, 'element', (node) => {
            if ('a' === node.tagName && /^(?:https?:)?\/\//iu.test(node.properties.href || '')) {
                // Breaks any existing `rel=''` attribute apart into a set of values.
                let relSet = new Set((node.properties.rel || '').toLowerCase().split(/\s+/u));

                if (!relSet.has('bookmark')) {
                    relSet.add('external');

                    if (!relSet.has('follow')) {
                        relSet.add('nofollow');
                    }
                }
                node.properties.rel = [...relSet].join(' ');
            }
            return node;
        });
    };
};
